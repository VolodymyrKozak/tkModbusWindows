/*
 * tk2_Slave3_1TEST.c
 *
 *  Created on: 22 лист. 2019 р.
 *      Author: KozakVF
 */
#include  <stdio.h>
#include "stdint.h"
#include "tk2_slave3_1.h"

  FILE *fpTK2;
  extern unsigned int arr[];
  int32_t arr3[256]={0};
  extern char SBUFrx [25];
  extern char SBUFtx [35];
  uint8_t testRx[100][100]={
		  /* запись пользовательских уставок одной группой */
		  {0x01, 0x10, 0x10, 0x00, 0x00, 0x08, 0x10 },
		  /* запись заводских уставок одной группой, пароль не был введен  */
		  {0x01, 0x10, 0x10, 0x14, 0x00, 0x0B, 0x16 },
		  /* ввод пароля */
		  {0x01, 0x06, 0x00, 0x05, 0x12, 0x34},
		  /* запись заводских уставок одной группой, пароль введен  */
		  {0x01, 0x10, 0x10, 0x14, 0x00, 0x0B, 0x16 },
		  /* сброс введенного пароля  - что угодно в 6-ю ячейку  */
		  {0x01, 0x06, 0x00, 0x06, 0x00, 0x00},


		  {0x01, 0x10, 0x10, 0x00, 0x00, 0x08, 0x11 },
		  {0x01, 0x10, 0x10, 0x01, 0x00, 0x08, 0x10 },
		  /* Запрос корректный на чтение заводских  уставок   */
		  /* Чтение всех заводстких уставок одним массивом     */
		  {0x01, 0x03, 0x10, 0x14, 0x00, 0x0B },
		  /* Чтение одной уставки */
		  {0x01, 0x03, 0x10, 0x15, 0x00, 0x01 },
		  /* Чтение двух выбраных уставок */
		  {0x01, 0x03, 0x10, 0x15, 0x00, 0x02 },
		  {0x01, 0x03, 0x10, 0x1C, 0x00, 0x02 },
		  {0x01, 0x03, 0x10, 0x1E, 0x00, 0x01 },

		  /* Запрос корректный на чтение пользовательстких уставок   */
		  {0x01, 0x03, 0x10, 0x00, 0x00, 0x08 },
		  {0x01, 0x03, 0x10, 0x00, 0x00, 0x04 },
		  {0x01, 0x03, 0x10, 0x07, 0x00, 0x01 },
		  {0x01, 0x03, 0x10, 0x04, 0x00, 0x03 },


		  {0x01, 0x03, 0x10, 0x01, 0x01, 0x08 },
		  {0x01, 0x03, 0x10, 0x01, 0x00, 0x08 },
		  /* 0   */
		  {0x01, 0x03, 0x01, 0x00, 0x00, 0x10 },
		  /* 0   */
		  {0x01, 0x03, 0x01, 0x01, 0x00, 0x10 },
		  /* 0   */
		  {0x01, 0x03, 0x01, 0x01, 0x00, 0x04 },
		  /* 0 ошибочный запрос  */
		  {0x01, 0x03, 0x01, 0x00, 0x00, 0x20 },
		  /* 0 Задание режима работы */
		  {0x01, 0x06, 0x00, 0x00, 0x00, 0x20},
		  /* 1 Режим автоматический дист. */
		  {0x01, 0x06, 0x00, 0x01, 0x00, 0x01},

		  /* 2 Команда 0х02 воспринимается только в режиме 31 или 33 */
		  {0x01, 0x06, 0x00, 0x02, 0x00, 0x01},
		  /* 3 Задание режима работы - дист.ручной */
		  {0x01, 0x06, 0x00, 0x00, 0x00, 0x1F},
		  /* 4 Теперь двигатель запускается  */
		  {0x01, 0x06, 0x00, 0x02, 0x00, 0x01},
		  /* 5 Включить/выключить ЭД
		   * недопустимая команда = может быть лишь 1,2,11*/
		  {0x01, 0x06, 0x00, 0x02, 0x00, 0x12},
		  /* 6 */
		  {0x01, 0x06, 0x00, 0x02, 0x00, 0x0B},

		  /* 7 */
		  {0x01, 0x06, 0x10, 0x00, 0x00, 0x12}



  };


  void tk2Test(void){
//	  fpTK2 = fopen("D:\\C_TK2OUTPUT.txt", "w");
//	  for (uint16_t i=0;i<40;i++){
//		  fprintf(fpTK2, "%8d ", arr[i]);
//	  }
//	  fclose(fpTK2);
	  fpTK2 = fopen("D:\\C_TK2OUTPUT.txt", "r");
	  for (uint16_t i=0;i<40;i++){
		  fscanf(fpTK2, "%8d ", &(arr3[i]));
	  }
	  fclose(fpTK2);

	  memset (SBUFrx, 0, sizeof(SBUFrx));
	  for(uint8_t i=0;i<10;i++){
		  memcpy(&SBUFrx, &testRx[i][0], sizeof(SBUFrx));
		  fTK2_Slave3_1();

		  if(i==4){
			  memset (SBUFtx, 0, sizeof(SBUFtx));
		  }
		  memset (SBUFtx, 0, sizeof(SBUFtx));
	  }
	  fpTK2 = fopen("D:\\C_TK2OUTPUT.txt", "w");
	  for (uint16_t i=0;i<40;i++){
	  	fprintf(fpTK2, "%8d ", arr[i]);
	  }
	  fclose(fpTK2);

  }
